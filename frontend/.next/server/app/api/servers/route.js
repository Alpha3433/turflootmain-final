"use strict";(()=>{var e={};e.id=6222,e.ids=[6222],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},12434:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>d,patchFetch:()=>m,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>y});var o={};r.r(o),r.d(o,{GET:()=>i});var a=r(49303),t=r(88716),l=r(60670),n=r(87070);async function i(e){try{console.log("\uD83C\uDFAE Colyseus Server Browser API: Fetching available Colyseus rooms...");let e=[],s=0;try{let{MongoClient:o}=await Promise.resolve().then(r.t.bind(r,38013,23)),a=new o(process.env.MONGO_URL);await a.connect();let t=a.db("turfloot").collection("game-sessions"),l=new Date(Date.now()-12e4),n=await t.find({"session.lastActivity":{$gte:l},"session.mode":{$regex:/colyseus/i}}).toArray();s=n.length,console.log(`ðŸ“Š Database shows ${s} active Colyseus players`);let i=new Map;n.forEach(e=>{let s=e.roomId||e.session?.roomId||"colyseus-arena-default",r=e.session?.region||"AU",o=e.session?.mode||"colyseus-multiplayer";i.has(s)?i.get(s).currentPlayers+=1:i.set(s,{id:s,name:`Arena Battle ${i.size>0?`#${i.size+1}`:""}`,serverType:"colyseus",roomType:"arena",region:r,mode:o,currentPlayers:1,maxPlayers:50,status:"active",avgWaitTime:"Join Now",entryFee:0,prizePool:0,colyseusRoomId:s,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!0,lastActivity:e.session?.lastActivity||new Date})}),(e=Array.from(i.values())).forEach(e=>{e.avgWaitTime=e.currentPlayers<e.maxPlayers?"Join Now":"Full",e.joinable=e.currentPlayers<e.maxPlayers,e.status=e.currentPlayers>0?"active":"waiting"}),console.log(`ðŸ“Š Found ${e.length} active Colyseus rooms from database`),await a.close()}catch(e){console.warn(`âš ï¸ Could not query database for Colyseus rooms:`,e.message),s=0}let o=[];return e.length>0?o.push(...e):o.push({id:"colyseus-arena-default",name:"Arena Battle",serverType:"colyseus",roomType:"arena",region:"AU",mode:"colyseus-multiplayer",currentPlayers:0,maxPlayers:50,status:"waiting",avgWaitTime:"Join Now",entryFee:0,prizePool:0,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!0}),console.log(`ðŸ“Š Returning ${o.length} Colyseus server(s) with ${s} total players`),console.log(`ðŸ” Server details:`,o.map(e=>`${e.name} (${e.currentPlayers}/${e.maxPlayers})`)),n.NextResponse.json({servers:o,totalPlayers:s,totalActiveServers:o.filter(e=>"active"===e.status).length,totalServers:o.length,practiceServers:0,cashServers:0,regions:["AU"],gameTypes:[{name:"Arena Battle",servers:o.length}],colyseusEnabled:!0,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud"})}catch(e){return console.error("âŒ Error in Colyseus server browser API:",e),n.NextResponse.json({error:"Failed to fetch Colyseus servers",message:e.message,servers:[],totalPlayers:0,totalActiveServers:0,colyseusEnabled:!1},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/servers/route",pathname:"/api/servers",filename:"route",bundlePath:"app/api/servers/route"},resolvedPagePath:"/app/frontend/app/api/servers/route.js",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:y,serverHooks:p}=u,d="/api/servers/route";function m(){return(0,l.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:y})}}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),o=s.X(0,[8948,5972],()=>r(12434));module.exports=o})();