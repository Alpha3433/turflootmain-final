"use strict";(()=>{var e={};e.id=6222,e.ids=[6222],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},12434:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>p});var s={};t.r(s),t.d(s,{GET:()=>u});var a=t(49303),o=t(88716),n=t(60670),l=t(87070),i=t(38013);async function u(){try{let e=new i.MongoClient(process.env.MONGO_URL);await e.connect();let r=e.db("turfloot").collection("game_sessions"),t=new Date(Date.now()-6e5);console.log("\uD83D\uDD0D FRONTEND SERVERS API: Querying for active sessions since:",t);let s=await r.find({lastActivity:{$gte:t},mode:{$regex:/colyseus/i},status:"active"}).toArray();console.log(`ðŸ” FRONTEND SERVERS API: Found ${s.length} active sessions:`,s.map(e=>({roomId:e.roomId,userId:e.userId,mode:e.mode,status:e.status,lastActivity:e.lastActivity})));let a=new Map;s.forEach(e=>{let r=e.roomId;r&&(a.has(r)?a.get(r).currentPlayers+=1:a.set(r,{id:r,name:"Active Arena Room",serverType:"colyseus",roomType:"arena",region:e.region||"AU",mode:e.mode||"colyseus-multiplayer",currentPlayers:1,maxPlayers:50,status:"active",avgWaitTime:"Join Now",entryFee:e.entryFee||0,prizePool:0,colyseusRoomId:r,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!0,lastActivity:e.lastActivity}))});let o=Array.from(a.values()),n=o.reduce((e,r)=>e+r.currentPlayers,0);return await e.close(),l.NextResponse.json({servers:[...o,{id:"colyseus-arena-default",name:"Arena Battle",serverType:"colyseus",roomType:"arena",region:"AU",mode:"colyseus-multiplayer",currentPlayers:0,maxPlayers:50,status:"template",avgWaitTime:"Create New",entryFee:0,prizePool:0,colyseusRoomId:"colyseus-arena",colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!1}],totalPlayers:n,totalActiveServers:o.length,totalServers:o.length+1,practiceServers:0,paidServers:0,lastUpdated:new Date().toISOString()})}catch(e){return console.error("âŒ Servers API Error:",e),l.NextResponse.json({servers:[{id:"colyseus-arena-default",name:"Arena Battle",serverType:"colyseus",roomType:"arena",region:"AU",mode:"colyseus-multiplayer",currentPlayers:0,maxPlayers:50,status:"template",avgWaitTime:"Create New",entryFee:0,prizePool:0,colyseusRoomId:"colyseus-arena",colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!1}],totalPlayers:0,totalActiveServers:0,totalServers:1,practiceServers:0,paidServers:0,lastUpdated:new Date().toISOString(),error:e.message})}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/servers/route",pathname:"/api/servers",filename:"route",bundlePath:"app/api/servers/route"},resolvedPagePath:"/app/frontend/app/api/servers/route.js",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:y}=c,m="/api/servers/route";function v(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:p})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972],()=>t(12434));module.exports=s})();