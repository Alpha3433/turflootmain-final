"use strict";(()=>{var e={};e.id=6222,e.ids=[6222],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},12434:(e,s,a)=>{a.r(s),a.d(s,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>y,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var t={};a.r(t),a.d(t,{GET:()=>c,dynamic:()=>i,revalidate:()=>u});var r=a(49303),o=a(88716),n=a(60670),l=a(87070);let i="force-dynamic",u=0;async function c(e){console.log("\uD83D\uDE80 DEDICATED SERVERS API CALLED AT:",new Date().toISOString());try{console.log("\uD83C\uDFAE REAL PRIVY USERS ONLY: Colyseus Server Browser API - Fetching rooms created by authenticated users...");let e=[],s=0;try{let{MongoClient:t}=await Promise.resolve().then(a.t.bind(a,38013,23)),r=new t(process.env.MONGO_URL);await r.connect();let o=r.db("turfloot").collection("game_sessions"),n=new Date(Date.now()-6e5);console.log(`🔍 Querying for sessions active since: ${n}`),console.log(`👤 FILTERING: Only showing sessions created by real Privy users (not anonymous)`);let l=await o.find({lastActivity:{$gte:n},mode:{$regex:/colyseus/i},status:"active",userId:{$exists:!0,$ne:"anonymous",$not:{$regex:/^anonymous/}}}).toArray();console.log(`🔍 Query found ${l.length} active sessions from REAL PRIVY USERS:`,l.map(e=>({roomId:e.roomId,userId:e.userId,mode:e.mode,lastActivity:e.lastActivity,status:e.status,isRealUser:"anonymous"!==e.userId&&!e.userId?.startsWith("anonymous")}))),s=l.length,console.log(`📊 Database shows ${s} active Colyseus players (REAL PRIVY USERS ONLY)`);let i=new Map;l.forEach(e=>{let s=e.roomId||"colyseus-arena-default",a=e.region||"AU",t=e.mode||"colyseus-multiplayer";i.has(s)?i.get(s).currentPlayers+=1:i.set(s,{id:s,name:0===i.size?"TurfLoot Arena":`Arena Battle #${i.size+1}`,serverType:"colyseus",roomType:"arena",region:a,mode:t,currentPlayers:1,maxPlayers:50,status:"active",avgWaitTime:"Join Now",entryFee:0,prizePool:0,colyseusRoomId:s,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!0,lastActivity:e.lastActivity||new Date,regionId:"au-syd",displayName:0===i.size?"Global Arena":`Arena #${i.size+1}`,gameType:"Arena Battle",description:"Real-time multiplayer arena with up to 50 players",minPlayers:1,waitingPlayers:0,isRunning:!0,ping:null,difficulty:"All Players",serverFee:0,totalCost:0,potentialWinning:0,stake:0,endpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",lastUpdated:new Date().toISOString(),timestamp:new Date().toISOString(),canJoin:!0})}),(e=Array.from(i.values())).forEach(e=>{e.avgWaitTime=e.currentPlayers<e.maxPlayers?"Join Now":"Full",e.joinable=e.currentPlayers<e.maxPlayers,e.canJoin=e.currentPlayers<e.maxPlayers,e.status=e.currentPlayers>0?"active":"waiting"}),console.log(`📊 Found ${e.length} active Colyseus rooms from database`),await r.close()}catch(e){console.warn(`⚠️ Could not query database for Colyseus rooms:`,e.message),s=0}let t=[];return e.length>0?t.push(...e):t.push({id:"colyseus-arena-global",roomType:"arena",name:"TurfLoot Arena",region:"Australia",regionId:"au-syd",displayName:"Global Arena",mode:"multiplayer",gameType:"Arena Battle",description:"Real-time multiplayer arena with up to 50 players",maxPlayers:50,minPlayers:1,currentPlayers:0,waitingPlayers:0,isRunning:!0,ping:null,avgWaitTime:"Join Now",difficulty:"All Players",entryFee:0,serverFee:0,totalCost:0,potentialWinning:0,prizePool:0,stake:0,status:"waiting",serverType:"colyseus",endpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",lastUpdated:new Date().toISOString(),timestamp:new Date().toISOString(),canJoin:!0,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!0}),console.log(`📊 Returning ${t.length} Colyseus server(s) with ${s} total players`),console.log(`🔍 Server details:`,t.map(e=>`${e.name} (${e.currentPlayers}/${e.maxPlayers})`)),l.NextResponse.json({servers:t,totalPlayers:s,totalActiveServers:t.filter(e=>"active"===e.status).length,totalServers:t.length,practiceServers:0,cashServers:0,regions:["Australia"],gameTypes:[{name:"Arena Battle",servers:t.length}],colyseusEnabled:!0,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",lastUpdated:new Date().toISOString(),timestamp:new Date().toISOString()},{headers:{"Cache-Control":"no-store, no-cache, must-revalidate, proxy-revalidate",Pragma:"no-cache",Expires:"0","Surrogate-Control":"no-store"}})}catch(e){return console.error("❌ Error in Colyseus server browser API:",e),l.NextResponse.json({error:"Failed to fetch Colyseus servers",message:e.message,servers:[],totalPlayers:0,totalActiveServers:0,colyseusEnabled:!1},{status:500})}}let y=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/servers/route",pathname:"/api/servers",filename:"route",bundlePath:"app/api/servers/route"},resolvedPagePath:"/app/frontend/app/api/servers/route.js",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=y,g="/api/servers/route";function v(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[8948,5972],()=>a(12434));module.exports=t})();