"use strict";(()=>{var e={};e.id=6222,e.ids=[6222],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},12434:(e,s,o)=>{o.r(s),o.d(s,{originalPathname:()=>d,patchFetch:()=>m,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>y});var r={};o.r(r),o.d(r,{GET:()=>i});var t=o(49303),a=o(88716),n=o(60670),l=o(87070);async function i(e){try{console.log("\uD83C\uDFAE Colyseus Server Browser API: Fetching available Colyseus rooms...");let e=[],s=0;try{let s=await fetch("https://au-syd-ab3eaf4e.colyseus.cloud/matchmake/arena");s.ok&&(e=await s.json()||[],console.log(`📊 Found ${e.length} active Colyseus rooms`))}catch(e){console.warn("⚠️ Could not fetch Colyseus rooms, showing generic arena:",e.message)}let r=0;try{let{MongoClient:e}=await Promise.resolve().then(o.t.bind(o,38013,23)),t=new e(process.env.MONGO_URL);await t.connect();let a=t.db("turfloot").collection("game-sessions"),n=new Date(Date.now()-12e4);s=r=await a.countDocuments({"session.lastActivity":{$gte:n},"session.mode":{$regex:/colyseus/i}}),console.log(`📊 Database shows ${r} active Colyseus players`),await t.close()}catch(e){console.warn(`⚠️ Could not query database for Colyseus players:`,e.message),r=0}let t=[];return e.length>0?e.forEach((e,s)=>{let o=e.clients||0,r=e.maxClients||50;t.push({id:e.roomId||`colyseus-arena-${s}`,name:`Arena Battle #${s+1}`,serverType:"colyseus",roomType:"arena",region:"AU",mode:"colyseus-multiplayer",currentPlayers:o,maxPlayers:r,status:o>0?"active":"waiting",avgWaitTime:o<r?"Join Now":"Full",entryFee:0,prizePool:0,colyseusRoomId:e.roomId,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:o<r})}):t.push({id:"colyseus-arena-default",name:"Arena Battle",serverType:"colyseus",roomType:"arena",region:"AU",mode:"colyseus-multiplayer",currentPlayers:r,maxPlayers:50,status:r>0?"active":"waiting",avgWaitTime:"Join Now",entryFee:0,prizePool:0,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud",joinable:!0}),console.log(`📊 Returning ${t.length} Colyseus server(s) with ${s} total players`),l.NextResponse.json({servers:t,totalPlayers:s,totalActiveServers:t.filter(e=>"active"===e.status).length,totalServers:t.length,practiceServers:0,cashServers:0,regions:["AU"],gameTypes:[{name:"Arena Battle",servers:t.length}],colyseusEnabled:!0,colyseusEndpoint:"wss://au-syd-ab3eaf4e.colyseus.cloud"})}catch(e){return console.error("❌ Error in Colyseus server browser API:",e),l.NextResponse.json({error:"Failed to fetch Colyseus servers",message:e.message,servers:[],totalPlayers:0,totalActiveServers:0,colyseusEnabled:!1},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/servers/route",pathname:"/api/servers",filename:"route",bundlePath:"app/api/servers/route"},resolvedPagePath:"/app/frontend/app/api/servers/route.js",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:y,serverHooks:p}=u,d="/api/servers/route";function m(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:y})}}};var s=require("../../../webpack-runtime.js");s.C(e);var o=e=>s(s.s=e),r=s.X(0,[8948,5972],()=>o(12434));module.exports=r})();