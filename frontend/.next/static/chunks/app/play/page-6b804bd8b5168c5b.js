(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9974],{46601:function(){},70789:function(e,t,a){Promise.resolve().then(a.bind(a,89804))},89804:function(e,t,a){"use strict";a.r(t);var r=a(57437),s=a(2265),i=a(6649),l=a(16463);t.default=()=>{let{authenticated:e,user:t,login:a,ready:o}=(0,i.s)(),n=(0,l.useRouter)(),[c,d]=(0,s.useState)("loading"),[h,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(0),[g,y]=(0,s.useState)({mass:10,rank:1}),[f,b]=(0,s.useState)(null),[p,v]=(0,s.useState)(""),[k,w]=(0,s.useState)(!1),N=(0,s.useRef)(null),j=(0,s.useRef)(null),S=(0,s.useRef)(null),D=(0,s.useRef)(null),[P,T]=(0,s.useState)({roomId:"lobby",mode:"free",fee:0});(0,s.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("matchId"),a=e.get("roomCode");T({roomId:a||e.get("room")||"lobby",mode:t?"lobby_match":e.get("mode")||"free",fee:parseInt(e.get("fee")||"0",10),matchId:t,roomCode:a}),t&&a&&console.log("\uD83C\uDFAE Lobby match detected:",{matchId:t,roomCode:a})},[]),(0,s.useEffect)(()=>{if(console.log("\uD83D\uDD0D Auth state check:",{authenticated:e,ready:o,hasUser:!!t}),!o){console.log("⏳ Privy still loading..."),d("loading");return}return e&&t?(console.log("✅ User is authenticated, initializing game"),d("lobby"),C(),E()):o&&!e&&(console.log("❌ User not authenticated, showing login screen"),v("Please login first to play the game"),d("needs_auth")),()=>{N.current&&N.current.disconnect(),S.current&&S.current.destroy()}},[e,t,o,P]);let C=async()=>{try{let e=await fetch("/api/wallet/balance",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}});if(e.ok){let t=await e.json();x(t.balance)}}catch(e){console.error("Error fetching balance:",e)}},E=()=>{e&&t&&(console.log("WebSocket implementation would be initialized here"),M())},I=()=>{if(!N.current||!e)return;let a=localStorage.getItem("auth_token");if(console.log("\uD83D\uDD11 Attempting to join room with token:",{hasToken:!!a,tokenLength:null==a?void 0:a.length,tokenPreview:a?a.substring(0,50)+"...":"null",roomId:P.roomId,mode:P.mode,fee:P.fee}),!a&&t){console.log("\uD83D\uDD11 No token found, creating one from Privy user..."),_(t);return}N.current.emit("join_room",{roomId:P.roomId,mode:P.mode,fee:P.fee,token:a})},_=async e=>{try{console.log("\uD83D\uDD11 Creating auth token for user:",e.id);let t=await fetch("/api/auth/privy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({privy_user:e})});if(t.ok){let e=await t.json();e.token?(localStorage.setItem("auth_token",e.token),console.log("✅ Auth token created and stored successfully"),setTimeout(()=>I(),500)):(console.error("❌ No token received from auth endpoint"),v("Failed to authenticate. Please try again."))}else console.error("❌ Failed to create auth token:",t.status),v("Authentication failed. Please try again.")}catch(e){console.error("❌ Error creating auth token:",e),v("Authentication error. Please try again.")}},M=()=>{if(j.current&&!S.current){class e extends Phaser.default.Scene{preload(){}create(){this.cameras.main.setZoom(.6),this.graphics=this.add.graphics(),this.myPlayerId=D.current,this.input.on("pointermove",e=>{if(this.myPlayerId&&N.current){var t;let a=this.cameras.main.getWorldPoint(e.x,e.y),r=null===(t=this.gameState)||void 0===t?void 0:t.players.find(e=>e.id===this.myPlayerId);if(r&&r.alive){let e=a.x-r.x,t=a.y-r.y,s=Math.hypot(e,t)||1;N.current.emit("set_direction",{x:e/s,y:t/s})}}})}handleGameState(e){this.gameState=e;let t=e.players.find(e=>e.id===this.myPlayerId);if(t&&t.alive){this.cameras.main.startFollow({x:t.x,y:t.y},!0,.08,.08);let e=Math.max(.4,Math.min(1,1/Math.sqrt(t.mass/10)));this.cameras.main.setZoom(e)}this.render()}render(){this.gameState&&(this.graphics.clear(),this.drawGrid(),this.gameState.food.forEach(e=>{this.graphics.fillStyle(1096065,1),this.graphics.fillCircle(e.x,e.y,5),this.graphics.fillStyle(1096065,.3),this.graphics.fillCircle(e.x,e.y,8)}),[...this.gameState.players].sort((e,t)=>e.mass-t.mass).forEach(e=>{if(!e.alive)return;let t=1.2*Math.sqrt(e.mass),a=e.id===this.myPlayerId,r=10265519;if(a)r=62975;else{let t=this.stringToHash(e.id),a=[16739179,5164484,4569041,9883316,16697943,16752627,5546239];r=a[Math.abs(t)%a.length]}if(this.graphics.fillStyle(0,.2),this.graphics.fillCircle(e.x+3,e.y+3,t),this.graphics.fillStyle(r,1),this.graphics.fillCircle(e.x,e.y,t),this.graphics.lineStyle(3,16777215,.8),this.graphics.strokeCircle(e.x,e.y,t),t>15){let a=.3*t,r=Math.max(2,.1*t);this.graphics.fillStyle(0,1),this.graphics.fillCircle(e.x-a,e.y-a,r),this.graphics.fillCircle(e.x+a,e.y-a,r)}let s=this.add.text(e.x,e.y-t-20,"".concat(e.nickname," (").concat(Math.floor(e.mass),")"),{fontSize:"".concat(Math.max(12,Math.min(18,.3*t)),"px"),color:"#ffffff",stroke:"#000000",strokeThickness:3,align:"center"});s.setOrigin(.5,.5),s.setDepth(10),this.time.delayedCall(50,()=>s.destroy())}))}drawGrid(){this.graphics.lineStyle(1,2042167,.3);let e=this.cameras.main.worldView,t=100*Math.floor(e.x/100),a=100*Math.ceil((e.x+e.width)/100),r=100*Math.floor(e.y/100),s=100*Math.ceil((e.y+e.height)/100);for(let e=t;e<=a;e+=100)this.graphics.beginPath(),this.graphics.moveTo(e,r),this.graphics.lineTo(e,s),this.graphics.strokePath();for(let e=r;e<=s;e+=100)this.graphics.beginPath(),this.graphics.moveTo(t,e),this.graphics.lineTo(a,e),this.graphics.strokePath()}stringToHash(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t}constructor(){super("TurfLootGame"),this.graphics=null,this.myPlayerId=null,this.gameState=null}}Phaser.default.AUTO,j.current,window.innerWidth,window.innerHeight,new e}};return o&&"loading"!==c?e&&"needs_auth"!==c?(0,r.jsxs)("div",{className:"min-h-screen bg-black text-white relative",children:[(0,r.jsx)("div",{ref:j,className:"absolute inset-0"}),(0,r.jsxs)("div",{className:"absolute top-4 left-4 space-y-4 pointer-events-none",children:[(0,r.jsxs)("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg p-4 border border-cyan-400/20",children:[(0,r.jsx)("div",{className:"text-cyan-400 font-bold text-lg",children:"TurfLoot"}),(0,r.jsxs)("div",{className:"text-sm text-gray-300",children:["Mass: ",g.mass]}),(0,r.jsxs)("div",{className:"text-sm text-gray-300",children:["Rank: #",g.rank]}),(0,r.jsxs)("div",{className:"text-sm text-gray-300",children:["Balance: $",m.toFixed(2)]})]}),h&&(0,r.jsxs)("div",{className:"bg-black/60 backdrop-blur-sm rounded-lg p-4 border border-yellow-400/20",children:[(0,r.jsxs)("div",{className:"text-yellow-400 font-bold",children:["Room: ",h.roomId]}),(0,r.jsxs)("div",{className:"text-sm text-gray-300",children:["Mode: ",h.mode," ",h.fee>0&&"($".concat(h.fee,")")]}),(0,r.jsxs)("div",{className:"text-sm text-gray-300",children:["Players: ",h.playerCount," (",h.readyCount," ready)"]})]})]}),"lobby"===c&&(0,r.jsx)("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 pointer-events-auto",children:(0,r.jsxs)("div",{className:"bg-black/80 backdrop-blur-sm rounded-xl p-6 border border-cyan-400/30",children:[(0,r.jsxs)("div",{className:"text-center mb-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-cyan-400 mb-2",children:"Ready to Play?"}),"cash"===P.mode&&(0,r.jsxs)("p",{className:"text-yellow-400 text-sm",children:["Entry Fee: $",P.fee]})]}),(0,r.jsx)("button",{onClick:()=>{if(!N.current||!e)return;if("cash"===P.mode&&m<P.fee){v("Insufficient balance. Required: $".concat(P.fee,", Available: $").concat(m));return}w(!0);let t=localStorage.getItem("auth_token");N.current.emit("player_ready",{token:t}),setTimeout(()=>w(!1),2e3)},disabled:k||"cash"===P.mode&&m<P.fee,className:"w-full bg-cyan-600 hover:bg-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-xl transition-all",children:k?"Joining...":"Ready to Play!"}),"cash"===P.mode&&m<P.fee&&(0,r.jsx)("p",{className:"text-red-400 text-sm mt-2 text-center",children:"Insufficient balance. Add funds to play."})]})}),"ended"===c&&f&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center pointer-events-auto",children:(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800 rounded-2xl p-8 border border-cyan-400/30 text-center max-w-md",children:[(0,r.jsx)("div",{className:"text-3xl font-bold mb-4",children:f.winnerId===D.current?"\uD83C\uDFC6 Victory!":"\uD83D\uDC80 Game Over"}),(0,r.jsxs)("div",{className:"text-gray-300 mb-6",children:[(0,r.jsxs)("p",{className:"mb-2",children:["Winner: ",f.winnerName]}),(0,r.jsxs)("p",{children:["Duration: ",Math.floor(f.duration/1e3),"s"]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 px-6 rounded-xl transition-all",children:"Play Again"}),(0,r.jsx)("button",{onClick:()=>n.push("/"),className:"w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-xl transition-all",children:"Back to Lobby"})]})]})}),p&&(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-auto",children:(0,r.jsx)("div",{className:"bg-red-600/90 backdrop-blur-sm rounded-lg p-4 border border-red-400/30",children:(0,r.jsx)("p",{className:"text-white font-bold",children:p})})}),(0,r.jsx)("div",{className:"absolute bottom-4 right-4 bg-black/60 backdrop-blur-sm rounded-lg p-3 border border-gray-600/30 pointer-events-none",children:(0,r.jsxs)("div",{className:"text-xs text-gray-300",children:[(0,r.jsx)("div",{children:"\uD83D\uDDB1️ Move mouse to control"}),(0,r.jsx)("div",{children:"\uD83C\uDF4E Eat food to grow"}),(0,r.jsx)("div",{children:"⚔️ Eat smaller players"})]})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center max-w-md",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold mb-4 text-cyan-400",children:"Login Required"}),(0,r.jsx)("p",{className:"text-gray-400 mb-6",children:"You need to login to play TurfLoot"}),(0,r.jsx)("button",{onClick:a,className:"bg-gradient-to-r from-cyan-500 to-cyan-400 hover:from-cyan-400 hover:to-cyan-300 text-black font-bold py-3 px-8 rounded-xl transition-all hover:scale-105 mb-4",children:"Login with Privy"}),(0,r.jsxs)("p",{className:"text-gray-500 text-sm",children:["Or go back to the ",(0,r.jsx)("button",{onClick:()=>n.push("/"),className:"text-cyan-400 hover:text-cyan-300 underline",children:"main lobby"})," to login first"]})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-cyan-400",children:"Loading TurfLoot..."}),(0,r.jsx)("p",{className:"text-gray-400",children:"Checking authentication status"})]})})}},16463:function(e,t,a){"use strict";var r=a(71169);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},6649:function(e,t,a){"use strict";a.d(t,{s:function(){return h}});var r=a(2265),s=a(72336),i=a(10280),l=a(79714);let o=async({emitPrivyEvent:e,getAccessToken:t,initializeWalletProxy:a,refreshUser:r,user:s},{privateKey:o,chainType:n})=>{if(!s)throw e("linkAccount","onError",l.sX.MUST_BE_AUTHENTICATED,{linkMethod:"siwe"}),new l.dx("User must be authenticated before linking an account.");let[c,d]=await Promise.all([t(),a(15e3)]);if(!d||!c)throw e("linkAccount","onError",l.sX.MUST_BE_AUTHENTICATED,{linkMethod:"siwe"}),new l.dx("User must be authenticated before linking an account.");await d.importWallet({privateKey:o,accessToken:c,chainType:n});let h=await r(),u="solana"===n?(0,i.Ry)(h):(0,i.Nc)(h);if(!u)throw e("createWallet","onError",l.sX.UNKNOWN_EMBEDDED_WALLET_ERROR),Error("Failed to import wallet");return e("createWallet","onSuccess",u),u};var n=a(74717),c=a(60052);let d=()=>{let{getAccessToken:e,user:t}=(0,s.b)(),{refreshUser:a,initializeWalletProxy:i}=(0,c.u)(),l=(0,n.rN)();return{importWallet:(0,r.useCallback)(({privateKey:r})=>o({getAccessToken:e,user:t,initializeWalletProxy:i,refreshUser:a,emitPrivyEvent:l},{privateKey:r,chainType:"ethereum"}),[t,e,a,i,l])}},h=()=>{let{importWallet:e}=d();return{...(0,r.useContext)(s.N),importWallet:e}}}},function(e){e.O(0,[2707,2971,7023,1744],function(){return e(e.s=70789)}),_N_E=e.O()}]);