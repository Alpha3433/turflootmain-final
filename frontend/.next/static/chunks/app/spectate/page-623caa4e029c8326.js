(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9156],{46601:function(){},52170:function(e,t,n){Promise.resolve().then(n.bind(n,46582))},46582:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(57437),s=n(2265),a=n(16463),o=n(6649),l=n(56360),i=n(10273),c=n(29273),d=n(88545),u=n(28869),m=e=>{let{roomId:t,gameMode:n="free",entryFee:m=0,stake:h="FREE"}=e,x=(0,s.useRef)(null),f=(0,s.useRef)(null),g=(0,s.useRef)(),p=(0,s.useRef)(null),b=(0,a.useRouter)(),{user:y,getAccessToken:v}=(0,o.s)(),[j,k]=(0,s.useState)(!1),[N,w]=(0,s.useState)(null),[D,E]=(0,s.useState)([]),[C,F]=(0,s.useState)(0),[A,S]=(0,s.useState)(null),[R,_]=(0,s.useState)(0),[M,T]=(0,s.useState)(0),[B,z]=(0,s.useState)(!1),[P,Z]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=()=>{z(/Mobi|Android/i.test(navigator.userAgent)||window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{if(!t)return;let e=!0;return(async()=>{try{let n=y?await v():null;if(!e)return;let r=io("/",{transports:["websocket","polling"],autoConnect:!0,reconnection:!0,reconnectionDelay:2e3,reconnectionAttempts:5,timeout:1e4});f.current=r,p.current=setTimeout(()=>{if(!j){console.error("❌ Connection timeout - falling back to demo mode"),Z("Connection timeout"),k(!0);let e=[{id:"demo1",nickname:"Demo Bot 1",x:100,y:100,mass:50,alive:!0,kills:2,deaths:0},{id:"demo2",nickname:"Demo Bot 2",x:-100,y:-100,mass:75,alive:!0,kills:1,deaths:1},{id:"demo3",nickname:"Demo Bot 3",x:200,y:-150,mass:60,alive:!0,kills:0,deaths:2}],t=[];for(let e=0;e<50;e++)t.push({id:"food_".concat(e),x:(Math.random()-.5)*800,y:(Math.random()-.5)*800});let n={timestamp:Date.now(),players:e,food:t,running:!0,worldBounds:{width:1e3,height:1e3,centerX:0,centerY:0},leaderboard:[{rank:1,nickname:"Demo Bot 2",mass:75,kills:1},{rank:2,nickname:"Demo Bot 3",mass:60,kills:0},{rank:3,nickname:"Demo Bot 1",mass:50,kills:2}],spectatorCount:1};w(n),E(e),S(e[0]),T(e.length),_(1)}},1e4),r.on("connect",()=>{e&&(console.log("\uD83D\uDC41️ Socket connected, joining as spectator..."),console.log("\uD83D\uDC41️ Testing simple connection..."),r.emit("join_as_spectator",{roomId:t,token:n||"guest"}),console.log("\uD83D\uDC41️ Sent join_as_spectator event for room:",t))}),r.on("spectator_joined",t=>{e&&(console.log("\uD83D\uDC41️ Successfully joined as spectator:",t),p.current&&(clearTimeout(p.current),p.current=null),k(!0),_(t.spectatorCount||0),T(t.playerCount||0))}),r.on("spectator_join_failed",t=>{e&&(console.error("❌ Failed to join as spectator:",t),k(!1))}),r.on("spectator_join_error",t=>{e&&(console.error("❌ Spectator join error:",t),k(!1))}),r.on("auth_error",t=>{e&&(console.error("❌ Authentication error:",t),k(!1))}),r.on("spectator_game_state",t=>{if(e){if(w(t),t.players){let e=t.players.filter(e=>e.alive);if(E(e),T(e.length),e.length>0&&(!A||!e.find(e=>e.id===A.id))){let t=e.sort((e,t)=>(t.mass||0)-(e.mass||0))[0];S(t),F(0),console.log("\uD83D\uDC41️ Following: ".concat(t.nickname))}}void 0!==t.spectatorCount&&_(t.spectatorCount)}}),r.on("spectator_count_update",t=>{e&&_(t.spectatorCount||0)}),r.on("disconnect",()=>{e&&(console.log("\uD83D\uDC41️ Spectator disconnected"),k(!1),w(null))})}catch(t){e&&console.error("❌ Failed to initialize spectator:",t)}})(),()=>{e=!1,p.current&&(clearTimeout(p.current),p.current=null),f.current&&(f.current.removeAllListeners(),f.current.disconnect(),f.current=null)}},[t,y,v]);let W=(0,s.useCallback)(e=>{let t=x.current;if(!t||!N||!A){g.current=requestAnimationFrame(W);return}let n=t.getContext("2d");(t.width!==t.offsetWidth||t.height!==t.offsetHeight)&&(t.width=t.offsetWidth,t.height=t.offsetHeight);let r=A.x||0,s=A.y||0;n.clearRect(0,0,t.width,t.height),n.save(),n.translate(t.width/2,t.height/2),n.scale(2.5,2.5),n.translate(-r,-s),N.worldBounds&&(n.strokeStyle="#333",n.lineWidth=1.2,n.strokeRect(-N.worldBounds.width/2,-N.worldBounds.height/2,N.worldBounds.width,N.worldBounds.height)),N.food&&Array.isArray(N.food)&&N.food.forEach(e=>{e&&"number"==typeof e.x&&"number"==typeof e.y&&(n.fillStyle="#FFD700",n.beginPath(),n.arc(e.x,e.y,4,0,2*Math.PI),n.fill())}),N.players&&Array.isArray(N.players)&&N.players.forEach(e=>{if(!e||!e.alive||"number"!=typeof e.x||"number"!=typeof e.y)return;let t=2*Math.sqrt(e.mass||10),r=e.id===A.id;n.fillStyle=r?"#00FF00":"#3B82F6",n.beginPath(),n.arc(e.x,e.y,t,0,2*Math.PI),n.fill(),n.strokeStyle=r?"#FFFF00":"#FFF",n.lineWidth=r?1.2:.8,n.stroke(),e.nickname&&(n.fillStyle=r?"#FFFF00":"#FFF",n.font="".concat(12,"px Arial"),n.textAlign="center",n.fillText(e.nickname,e.x,e.y-t-8)),n.fillStyle=r?"#FFFF00":"#FFD700",n.font="".concat(10,"px Arial"),n.fillText("".concat(Math.floor(e.mass||0)),e.x,e.y+t+10)}),n.restore(),g.current=requestAnimationFrame(W)},[N,A]);(0,s.useEffect)(()=>(N&&A&&x.current&&(g.current=requestAnimationFrame(W)),()=>{g.current&&cancelAnimationFrame(g.current)}),[W,N,A]);let I=()=>{if(0===D.length)return;let e=(C+1)%D.length;F(e),S(D[e]),console.log("\uD83D\uDC41️ Cycling to: ".concat(D[e].nickname))},U=async()=>{if(!y&&m>0){console.log("\uD83D\uDD10 Authentication required for paid games");return}try{console.log("\uD83C\uDFAE Joining match...");let e="/agario?roomId=".concat(t,"&mode=").concat(n,"&fee=").concat(m);b.push(e)}catch(e){console.error("❌ Failed to join match:",e)}};return j?(0,r.jsxs)("div",{className:"min-h-screen bg-black relative overflow-hidden",children:[(0,r.jsx)("canvas",{ref:x,className:"w-full h-full absolute inset-0"}),(0,r.jsx)("div",{className:"absolute top-4 left-4 z-10",children:(0,r.jsx)(i.Zb,{className:"bg-black/80 border-gray-600",children:(0,r.jsxs)(i.aY,{className:"p-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-white mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4 text-blue-400"}),(0,r.jsxs)("span",{children:[R," watching"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 text-green-400"}),(0,r.jsxs)("span",{children:[M," playing"]})]}),(0,r.jsx)("div",{className:"text-yellow-400 font-bold",children:"FREE"===h?"PRACTICE":"$".concat(h," CASH")})]}),(0,r.jsxs)(l.z,{onClick:()=>{b.push("/")},variant:"secondary",size:"sm",className:"bg-black/80 border-gray-600 text-white hover:bg-gray-700 w-full",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4 mr-1"}),"Exit to Menu"]})]})})}),A&&(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsx)(i.Zb,{className:"bg-black/80 border-yellow-500/50",children:(0,r.jsxs)(i.aY,{className:"p-3",children:[(0,r.jsx)("div",{className:"text-yellow-400 font-bold text-lg",children:A.nickname}),(0,r.jsxs)("div",{className:"text-white text-sm",children:["Mass: ",Math.floor(A.mass||0)]}),(0,r.jsxs)("div",{className:"text-gray-400 text-xs",children:["Player ",C+1," of ",D.length]})]})})}),!B&&(0,r.jsxs)("div",{className:"absolute bottom-24 left-1/2 transform -translate-x-1/2 flex gap-4",children:[(0,r.jsxs)("button",{onClick:I,disabled:D.length<=1,className:"px-6 py-3 rounded-lg font-bold transition-all flex items-center gap-2 ".concat(D.length<=1?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-purple-500 hover:bg-purple-400 text-white"),children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDC41️"}),(0,r.jsxs)("span",{children:["Next Player (",D.length,")"]})]}),(0,r.jsxs)("button",{onClick:U,className:"px-6 py-3 rounded-lg font-bold transition-all bg-green-500 hover:bg-green-400 text-white",children:["\uD83C\uDFAE Join Match ","FREE"===h?"- FREE":"- $".concat(h)]})]}),B&&(0,r.jsxs)("div",{className:"fixed bottom-5 right-5 flex flex-row gap-6 z-50",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 30px)",right:"20px"},children:[(0,r.jsx)("div",{className:"relative rounded-full flex items-center justify-center cursor-pointer transition-all duration-200 active:scale-95",onClick:I,style:{touchAction:"none",userSelect:"none",WebkitUserSelect:"none",width:"75px",height:"75px",padding:"6px",zIndex:1001},children:(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white text-xs font-bold rounded-full border-2 transition-all duration-200 ".concat(D.length<=1?"bg-gray-800/60 border-gray-700":"bg-purple-800/80 border-purple-600 hover:bg-purple-700/90"),children:[(0,r.jsx)("div",{className:"text-lg",children:"\uD83D\uDC41️"}),(0,r.jsxs)("div",{className:"text-center leading-tight",children:[(0,r.jsx)("div",{className:"text-xs",children:"NEXT"}),(0,r.jsxs)("div",{className:"text-xs",children:["(",D.length,")"]})]})]})}),(0,r.jsx)("div",{className:"relative rounded-full flex items-center justify-center cursor-pointer transition-transform duration-200 active:scale-95",onClick:U,style:{touchAction:"none",userSelect:"none",WebkitUserSelect:"none",width:"90px",height:"90px",padding:"8px",zIndex:1001},children:(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white text-xs font-bold rounded-full border-2 transition-all duration-200 bg-gradient-to-br from-green-400 via-green-500 to-green-600 border-green-400 hover:from-green-300 hover:via-green-400 hover:to-green-500",children:[(0,r.jsx)("div",{className:"text-lg",children:"\uD83C\uDFAE"}),(0,r.jsxs)("div",{className:"text-center leading-tight",children:[(0,r.jsx)("div",{children:"JOIN"}),(0,r.jsx)("div",{className:"text-xs",children:"FREE"===h?"FREE":"$".concat(h)})]})]})})]}),!N&&j&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:(0,r.jsx)(i.Zb,{className:"bg-black/80 border-gray-700",children:(0,r.jsxs)(i.aY,{className:"p-6 text-center",children:[(0,r.jsx)(c.Z,{className:"h-8 w-8 text-blue-500 mx-auto mb-2 animate-pulse"}),(0,r.jsx)("p",{className:"text-white",children:"Waiting for game data..."})]})})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,r.jsx)(i.Zb,{className:"w-96 bg-black/80 border-gray-700",children:(0,r.jsxs)(i.aY,{className:"p-8 text-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Z,{className:"h-16 w-16 text-blue-400 mx-auto mb-6 animate-pulse"}),(0,r.jsx)("div",{className:"absolute -inset-2 bg-blue-400/20 rounded-full animate-ping"})]}),(0,r.jsx)("h2",{className:"text-2xl font-bold mb-3 text-white",children:"FREE"===h?"Entering Practice Match...":"Entering $".concat(h," Match...")}),(0,r.jsx)("p",{className:"text-gray-400 mb-4",children:P?"Connection issue - starting demo mode...":"FREE"===h?"Connecting to practice game...":"Connecting to $".concat(h," cash game...")}),(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("div",{className:"w-8 h-1 bg-blue-400 rounded animate-pulse"})}),(0,r.jsx)(l.z,{onClick:()=>{console.log("\uD83D\uDC41️ Manual connection fallback"),k(!0);let e=[{id:"demo1",nickname:"Demo Bot 1",x:100,y:100,mass:50,alive:!0,kills:2,deaths:0},{id:"demo2",nickname:"Demo Bot 2",x:-100,y:-100,mass:75,alive:!0,kills:1,deaths:1},{id:"demo3",nickname:"Demo Bot 3",x:200,y:-150,mass:60,alive:!0,kills:0,deaths:2}],t=[];for(let e=0;e<50;e++)t.push({id:"food_".concat(e),x:(Math.random()-.5)*800,y:(Math.random()-.5)*800});w({timestamp:Date.now(),players:e,food:t,running:!0,worldBounds:{width:1e3,height:1e3,centerX:0,centerY:0},leaderboard:[{rank:1,nickname:"Demo Bot 2",mass:75,kills:1},{rank:2,nickname:"Demo Bot 3",mass:60,kills:0},{rank:3,nickname:"Demo Bot 1",mass:50,kills:2}],spectatorCount:1}),E(e),S(e[0]),T(e.length),_(1)},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Continue Anyway"})]})})})};function h(){let e=(0,a.useSearchParams)(),t=e.get("roomId"),n=e.get("mode")||"free",s=parseFloat(e.get("fee"))||0;e.get("autoSpectate");let o=e.get("stake")||(0===s?"FREE":s.toString());return t?(0,r.jsx)(m,{roomId:t,gameMode:n,entryFee:s,stake:o}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center",children:(0,r.jsx)(i.Zb,{className:"w-96",children:(0,r.jsxs)(i.aY,{className:"p-6 text-center",children:[(0,r.jsx)(c.Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Invalid Spectator Request"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"No room ID provided. Please return to the lobby and try again."})]})})})}function x(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center",children:(0,r.jsx)(i.Zb,{className:"w-96",children:(0,r.jsxs)(i.aY,{className:"p-6 text-center",children:[(0,r.jsx)(c.Z,{className:"h-12 w-12 text-blue-500 mx-auto mb-4 animate-pulse"}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Loading Spectator Mode..."}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Preparing your spectator experience..."})]})})}),children:(0,r.jsx)(h,{})})}},56360:function(e,t,n){"use strict";n.d(t,{z:function(){return c}});var r=n(57437),s=n(2265),a=n(92974),o=n(13027),l=n(77700);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:n,variant:s,size:o,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(i({variant:s,size:o,className:n})),ref:t,...d})});c.displayName="Button"},10273:function(e,t,n){"use strict";n.d(t,{Ol:function(){return l},Zb:function(){return o},aY:function(){return c},ll:function(){return i}});var r=n(57437),s=n(2265),a=n(77700);let o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",n),...s})});o.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",n),...s})});l.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("font-semibold leading-none tracking-tight",n),...s})});i.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",n),...s})}).displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",n),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",n),...s})}).displayName="CardFooter"},77700:function(e,t,n){"use strict";n.d(t,{cn:function(){return a}});var r=n(44839),s=n(96164);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}},16463:function(e,t,n){"use strict";var r=n(71169);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},6649:function(e,t,n){"use strict";n.d(t,{s:function(){return u}});var r=n(2265),s=n(72336),a=n(10280),o=n(79714);let l=async({emitPrivyEvent:e,getAccessToken:t,initializeWalletProxy:n,refreshUser:r,user:s},{privateKey:l,chainType:i})=>{if(!s)throw e("linkAccount","onError",o.sX.MUST_BE_AUTHENTICATED,{linkMethod:"siwe"}),new o.dx("User must be authenticated before linking an account.");let[c,d]=await Promise.all([t(),n(15e3)]);if(!d||!c)throw e("linkAccount","onError",o.sX.MUST_BE_AUTHENTICATED,{linkMethod:"siwe"}),new o.dx("User must be authenticated before linking an account.");await d.importWallet({privateKey:l,accessToken:c,chainType:i});let u=await r(),m="solana"===i?(0,a.Ry)(u):(0,a.Nc)(u);if(!m)throw e("createWallet","onError",o.sX.UNKNOWN_EMBEDDED_WALLET_ERROR),Error("Failed to import wallet");return e("createWallet","onSuccess",m),m};var i=n(74717),c=n(60052);let d=()=>{let{getAccessToken:e,user:t}=(0,s.b)(),{refreshUser:n,initializeWalletProxy:a}=(0,c.u)(),o=(0,i.rN)();return{importWallet:(0,r.useCallback)(({privateKey:r})=>l({getAccessToken:e,user:t,initializeWalletProxy:a,refreshUser:n,emitPrivyEvent:o},{privateKey:r,chainType:"ethereum"}),[t,e,n,a,o])}},u=()=>{let{importWallet:e}=d();return{...(0,r.useContext)(s.N),importWallet:e}}},28869:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(17934).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},29273:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(17934).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},88545:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(17934).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])}},function(e){e.O(0,[2707,346,2971,7023,1744],function(){return e(e.s=52170)}),_N_E=e.O()}]);