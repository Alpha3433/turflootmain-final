"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4507],{4507:function(o,e,s){s.d(e,{joinArena:function(){return a}});var n=s(32609);class t{async joinArena(o){let{privyUserId:e,playerName:s=null}=o;try{console.log("\uD83D\uDE80 Attempting Colyseus Cloud connection..."),console.log("\uD83D\uDD17 Endpoint: ".concat(this.endpoint)),console.log("\uD83D\uDC64 User: ".concat(e,", Name: ").concat(s)),this.client=new n.KU(this.endpoint);let o=new Promise((o,e)=>setTimeout(()=>e(Error("Connection timeout after 15 seconds")),15e3));console.log("\uD83C\uDFDF️ Looking for available arena rooms...");try{console.log("\uD83D\uDD0D Attempting to join existing arena room...");let n=this.client.join("arena",{privyUserId:e,playerName:s||"Player_".concat(Math.random().toString(36).substring(7))});this.room=await Promise.race([n,o]),console.log("✅ Successfully joined existing arena room!")}catch(t){console.log("\uD83C\uDFD7️ No available rooms found, creating new arena room...");let n=this.client.create("arena",{privyUserId:e,playerName:s||"Player_".concat(Math.random().toString(36).substring(7))});this.room=await Promise.race([n,o]),console.log("✅ Successfully created new arena room!")}return this.isConnected=!0,console.log("✅ Connected to Colyseus Cloud arena room"),console.log("\uD83C\uDFAE Room ID: ".concat(this.room.roomId)),console.log("\uD83D\uDC65 Session ID: ".concat(this.room.sessionId)),this.setupEventListeners(),this.room}catch(o){throw console.error("❌ Colyseus connection failed:",o.message),console.error("\uD83D\uDD0D Full error details:",o),this.isConnected=!1,Error("Colyseus connection failed: ".concat(o.message))}}async createLocalMultiplayerRoom(o){let{privyUserId:e,playerName:s=null}=o;console.log("\uD83C\uDFE0 Creating local multiplayer room...");try{let o={id:"local_room_".concat(Date.now()),roomId:"local_room_".concat(Date.now()),sessionId:"session_".concat(e),state:{players:new Map,coins:new Map,viruses:new Map},onStateChange:o=>{console.log("\uD83D\uDCCA Local room state change listener registered"),this.stateChangeCallback=o,setTimeout(()=>{this.simulateMultiplayerState()},1e3)},onError:o=>{this.errorCallback=o},onLeave:o=>{this.leaveCallback=o},send:(o,e)=>{console.log("\uD83D\uDCE4 Sending ".concat(o,":"),e)},leave:()=>{console.log("\uD83D\uDC4B Leaving local multiplayer room"),this.isConnected=!1}};return this.room=o,this.isConnected=!0,this.fallbackMode=!0,console.log("✅ Local multiplayer room created"),console.log("\uD83C\uDFAE Local Room ID: ".concat(o.roomId)),o}catch(o){throw console.error("❌ Failed to create local multiplayer room:",o),o}}simulateMultiplayerState(){if(!this.stateChangeCallback||!this.room)return;let o={players:new Map,coins:new Map,viruses:new Map,size:0};o.players.set(this.room.sessionId,{x:1e3,y:1e3,radius:20,mass:20,name:"You",color:"#4ECDC4",score:0,alive:!0}),o.players.set("mock_player_1",{x:800,y:800,radius:15,mass:15,name:"Player 1",color:"#FF6B6B",score:50,alive:!0}),o.players.set("mock_player_2",{x:1200,y:1200,radius:25,mass:25,name:"Player 2",color:"#45B7D1",score:120,alive:!0}),o.players.size=o.players.size||3,console.log("\uD83C\uDFAD Simulating multiplayer state with",o.players.size,"players"),this.stateChangeCallback(o),this.isConnected&&setTimeout(()=>this.simulateMultiplayerState(),2e3)}setupEventListeners(){this.room&&(this.room.onStateChange(o=>{if(console.log("\uD83D\uDCCA Arena state updated"),o){var e,s,n;console.log("\uD83D\uDC65 Players: ".concat((null===(e=o.players)||void 0===e?void 0:e.size)||0)),console.log("\uD83E\uDE99 Coins: ".concat((null===(s=o.coins)||void 0===s?void 0:s.size)||0)),console.log("\uD83E\uDDA0 Viruses: ".concat((null===(n=o.viruses)||void 0===n?void 0:n.size)||0))}}),this.room.onStateChange.once(o=>{o&&o.players&&(o.players.onAdd=(o,e)=>{console.log("\uD83D\uDC4B Player joined: ".concat(o.name||"Unknown"," (").concat(e,")"))},o.players.onRemove=(o,e)=>{console.log("\uD83D\uDC4B Player left: ".concat(e))},o.players.onChange=(o,e)=>{console.log("\uD83D\uDD04 Player updated: ".concat(e))}),o&&o.coins&&(o.coins.onAdd=(o,e)=>{console.log("\uD83E\uDE99 Coin spawned: ".concat(e))},o.coins.onRemove=(o,e)=>{console.log("\uD83E\uDE99 Coin collected: ".concat(e))}),o&&o.viruses&&(o.viruses.onAdd=(o,e)=>{console.log("\uD83E\uDDA0 Virus spawned: ".concat(e))},o.viruses.onRemove=(o,e)=>{console.log("\uD83E\uDDA0 Virus removed: ".concat(e))})}),this.room.onMessage("gameState",o=>{console.log("\uD83C\uDFAE Game state message:",o)}),this.room.onMessage("playerJoined",o=>{console.log("\uD83D\uDC64 Player joined:",o)}),this.room.onMessage("playerLeft",o=>{console.log("\uD83D\uDC4B Player left:",o)}),this.room.onError((o,e)=>{console.error("\uD83D\uDEA8 Room error:",o,e)}),this.room.onLeave(o=>{console.log("\uD83D\uDEAA Left room with code:",o),this.isConnected=!1}))}sendInput(o,e,s){if(!this.room||!this.isConnected){console.warn("⚠️ Cannot send input: not connected to room");return}this.room.send("input",{seq:o,dx:e,dy:s})}sendPing(){this.room&&this.isConnected&&this.room.send("ping",{timestamp:Date.now()})}leave(){this.room&&(this.room.leave(),this.room=null),this.isConnected=!1,console.log("\uD83D\uDC4B Disconnected from Colyseus Cloud server")}getGameState(){var o;return(null===(o=this.room)||void 0===o?void 0:o.state)||null}getPlayer(o){var e,s,n;return(null===(n=this.room)||void 0===n?void 0:null===(s=n.state)||void 0===s?void 0:null===(e=s.players)||void 0===e?void 0:e.get(o))||null}getCurrentPlayer(){var o;return this.getPlayer(null===(o=this.room)||void 0===o?void 0:o.sessionId)}getAllPlayers(){var o,e;if(!(null===(e=this.room)||void 0===e?void 0:null===(o=e.state)||void 0===o?void 0:o.players))return[];let s=[];return this.room.state.players.forEach((o,e)=>{s.push({...o,sessionId:e})}),s}getLeaderboard(){return this.getAllPlayers().filter(o=>o.alive).sort((o,e)=>e.score-o.score).slice(0,10).map(o=>({name:o.name,score:o.score,mass:Math.round(o.mass)}))}constructor(){this.client=null,this.room=null,this.isConnected=!1,this.endpoint="wss://au-syd-ab3eaf4e.colyseus.cloud",this.fallbackMode=!1,console.log("\uD83C\uDFAE TurfLoot Colyseus Client initialized"),console.log("\uD83D\uDD17 Primary Endpoint: ".concat(this.endpoint))}}let l=new t,a=o=>{let{privyUserId:e,playerName:s}=o;return l.joinArena({privyUserId:e,playerName:s})}}}]);